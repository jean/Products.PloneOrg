[buildout]
extensions =
    mr.developer
    buildout.dumppickedversions
auto-checkout = xdv
extends = 
    http://dist.plone.org/release/4.0b3/versions.cfg
    versions.cfg
versions = versions
parts =
    instance1
    zopepy
    xdv
    default.xsl
    wide.xsl
    nginx
    nginx.conf
    plone.org.conf
    bootstrap

find-links =
    http://dist.plone.org/thirdparty/PILwoTk-1.1.6.4.tar.gz
    http://dist.plone.org/thirdparty/python-ldap-2.2.1.tar.gz

eggs =
    PILwoTk
    Plone
    Products.PloneOrg

# 16:17 < jonstahl> ok, related question, aclark: is it possible to sanity-check and get 
# http://plone.org/products/collective.contentrules.mailtogroup installed so I can send notifications to, say 
# the group of plone.org content reviewers?
# http://pypi.python.org/pypi/collective.contentrules.mailtogroup
# http://pypi.python.org/pypi/collective.contentrules.mailtolocalrole
    collective.contentrules.mailtogroup
    collective.contentrules.mailtolocalrole

zcml = 

    collective.contentrules.mailtogroup
    collective.contentrules.mailtolocalrole

develop =

[sources]
zope.structuredtext = svn http://svn.zope.org/repos/main/zope.structuredtext/trunk
xdv = svn https://codespeak.net/svn/z3/xdv/trunk

[instance1]
recipe = plone.recipe.zope2instance
user = admin:admin
http-address = ${ports:instance1}

eggs =
    ${buildout:eggs}

zcml =
    ${buildout:zcml}

zope-conf-additional =
    <zodb_db catalog>
        mount-point /plone.org/portal_catalog
        container-class Products.CMFPlone.CatalogTool.CatalogTool
        cache-size 10000
        <filestorage 2>
            path ${buildout:directory}/var/filestorage/CatalogData.fs
        </filestorage>
    </zodb_db>
    <environment>
        DISABLE_PTS 1
        TEMP ${buildout:directory}/tmp
    </environment>

[zopepy]
recipe = zc.recipe.egg
eggs =
    ${instance1:eggs}
    ${xdv:eggs}
interpreter = zopepy
scripts = zopepy

[xdv]
recipe = zc.recipe.egg
eggs = xdv

[nginx]
recipe = zc.recipe.cmmi
url = http://html-xslt.googlecode.com/files/nginx-0.7.65-html-xslt-2.tar.gz
md5sum = f863bdfdbeb01c11677d856c78716b35
extra_options =
    --conf-path=${buildout:directory}/etc/nginx.conf
    --error-log-path=${buildout:directory}/var/log/nginx-error.log
    --http-log-path=${buildout:directory}/var/log/nginx-access.log
    --pid-path=${buildout:directory}/var/nginx.pid
    --lock-path=${buildout:directory}/var/nginx.lock
    --with-http_stub_status_module
    --with-http_realip_module
    --with-http_xslt_module
#    --with-libxml2=${lxml:xml2-location}
#    --with-libxslt=${lxml:xslt-location}
#    --with-debug --with-cc-opt="-O0" # helps debugging with gdb

[nginx.conf]
recipe = collective.recipe.template
input = ${buildout:directory}/templates/nginx.conf.in
output = ${buildout:directory}/etc/nginx.conf

[plone.org.conf]
recipe = collective.recipe.template
listen = ${ports:nginx}
server_name = ${hostnames:main}
manage-server_name = ${hostnames:manage}
virtual-host = VirtualHostBase/http/${hostnames:main}:${ports:main}/plone.org/VirtualHostRoot
manage-virtual-host = VirtualHostBase/http/${hostnames:manage}:${ports:main}/plone.org/VirtualHostRoot
upstream =
    server ${hosts:localhost}:${ports:instance1};
input = ${buildout:directory}/templates/plone.org.conf.in
output = ${buildout:directory}/etc/vhosts/plone.org.conf

[default.xsl]
recipe = plone.recipe.command
command = 
    ${buildout:bin-directory}/xdvcompiler \
        --output=${buildout:directory}/etc/default.xsl \
        --extra=${buildout:directory}/static/rules/default-extra.xsl \
        ${buildout:directory}/static/rules/default.xml \
        ${buildout:directory}/static/plone.html
update-command = ${:command}

[wide.xsl]
recipe = plone.recipe.command
command = 
    ${buildout:bin-directory}/xdvcompiler \
        --output=${buildout:directory}/etc/wide.xsl \
        --extra=${buildout:directory}/static/rules/default-extra.xsl \
        ${buildout:directory}/static/rules/default.xml \
        ${buildout:directory}/static/plone-wide.html
update-command = ${:command}

[hosts]
localhost = 127.0.0.1
lanhost = 127.0.0.2
# note on mac os x you may need to enable this with
# sudo ifconfig lo0 alias 127.0.0.2 up

[ports]
main = 5000
nginx = 5001
instance1 = 5011

[hostnames]
main = localhost
manage = 127.0.0.1

[bootstrap]
recipe = collective.recipe.bootstrap
